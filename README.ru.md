#Xgrab
**Xgrab** - программа предназначенная для захвата видео с экрана с помощью программ *ffmpeg* или *avconv*.
Данная программа написана на языке сценариев *bash* и использует для управления графический диалог [Yad](https://sourceforge.net/projects/yad-dialog/ "ресурс с исходным кодом").  
Скачать можно командой:
```console
$ git clone https://github.com/ormorph/xgrab.git
```

Данная программа запускается скриптом xgrab.sh в текущей директории:
```console
$ ./xgrab.sh
```
по этому запускать ее рекомендуется скриптом вида:
```bash
#!/bin/bash

cd PATH/xgrab
./xgrab.sh
```
В качестве зависимостей данная программа использует следующие программы:  
**xrandr** — для получения информации о текущем разрешении экрана, когда в настройках выбран режим display;  
**xwininfo** — для получения информации о текущем положении и разрешении выбранного окна, когда в настройках выбран режим window;  
**xrectsel** — для выделения области экрана и получения информации, когда выбран режим size.

В настройках *опции захвата видео* используются строки на место которых скрипт подставляет значения переменных:  
**$SCR_SIZE** — подставляется значение вида 1366x768, означает разрешение области захвата.  
**$DISPLAY** — на место этой строки подставляется значение системной переменной DISPLAY, и смещение позиции захватываемой области.

В настройках *опции сжатия* используются строки на место которых подставляются значения переменных, это:  
**TARGET_WIDTH** — ширина сжимаемого видео;  
**TARGET_HEIGHT** — высота сжимаемого видео.

Так как кодек *libx264* не во все разрешения может производить конвертацию, было принято решение сделать данные параметры кратными 2, т. е. если разрешение исходного файла 1366x767, то эти данные параметры принимают вид:  
TARGET_WIDTH=1366  
TARGET_HEIGHT=766

При первом запуске скрипт копирует конфигурационные файлы в каталог **$HOME/.xgrab**, соответственно выполняемую его часть можно поместить в директорию с правами *root*, а запускать под обычным пользователем.  
За автоматический выбор команды(ffmpeg, avconv) отвечает файл *command*,

По умолчанию захват в настройках прописан через *pulseaudio*, параметры звука при первом запуске необходимо отредактировать, что бы не было падений из за отсутствующего устройства.  
Параметр:
```
-f pulse -i alsa_output.pci-0000_00_1b.0.analog-stereo.monitor -acodec pcm_s16le
```

строка устройства вывода звука(пример: **alsa_output.pci-0000_00_1b.0.analog-stereo.monitor**) берется из вывода:
```console
$ pactl list short sources
```

При разрешении 1366x768 полная команда захвата получается:
```console
$ ffmpeg -f pulse -i alsa_output.pci-0000_00_1b.0.analog-stereo.monitor -acodec pcm_s16le -f x11grab -s 1366x768 -r 10 -i $DISPLAY -vcodec mpeg4 -q:v 0 /home/USER/screenshot/53572030.mp4
```
Выполнив команду в консоли можно оттестировать работоспособность подобранных опций для работы *ffmpeg* либо *avconv*.

Окно настроек:  
<img src="http://s11.radikal.ru/i183/1612/fa/eb054e5ea5df.gif" title="Окно настроек" width="550" />

Управление программой осуществляется через иконку в системном трее.  
По умолчанию файлы сохраняются в каталог **$HOME/screenshot**, название генерируется автоматически(случайное цифры).

При установленной в настройках галочке *compress*, по окончанию захвата производится конвертирование файла в более сжатый формат с отображением в индикаторе прогресса, сколько процентов конвертирования уже выполнено.  
По окончанию сжатия в каталоге **$HOME/screenshot** будет находиться файл вида *VID_xxxxxxxx.mp4*, созданный(сконвертированный) на базе файла *xxxxxxxx.mp4*, который в свою очередь будет удален.

